<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="饮夏"><link href="https://cdn.bootcss.com/KaTeX/0.7.1/katex.min.css" rel="stylesheet"><script>(function(d) {
  var config = {
    kitId: 'mtg4doj',
    scriptTimeout: 3000,
    async: true
  },
  h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
})(document);
</script><title>给博客加个夜间模式吧 · 饮夏的blog</title><meta name="description" content="白天都无人问津的破网站，真的还有人晚上来吗?

点击按钮切换模式

其实实现原理很简单:
点击checkbox的时候，为body新增（或移除）名为night的class，
然后在css的night.class里加入夜间模式的代码。
//利用classList.add函数给body新增一个class
"><meta name="keywords" content=""><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/Aplayer.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.0/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.0/dist/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js"></script>
<style>
.aplayer .aplayer-lrc {
    height: 30px;
  }
.aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #58B2DC
}
.aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
}
.aplayer.aplayer-fixed .aplayer-lrc {
    display: inherit;

}
.aplayer .aplayer-lrc.aplayer-lrc-hide {
    display:none !important;
}
.aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(88, 178,220, 0.8);
}
</style>
<meta name="generator" content="Hexo 4.2.1"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body class="night"><div id="stage" class="container"><div class="row"><div id="side-bar" class="col-sm-3 col-xs-12 side-container invisible"><div class="vertical-text site-title"><h3 tabindex="-1" class="site-title-small"><a href="/" class="a-title">与世界分享世界</a></h3><h1 tabindex="-1" class="site-title-large"><a href="/" class="a-title">饮夏</a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div id="site-nav" class="site-title-links"><ul><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/categories">分类</a></li><li><a href="/tags">标签</a></li><li><a href="/about/index.html">关于</a></li><li class="soc"><a href="https://github.com/sansan-han" target="_blank" rel="noopener noreferrer"><i class="fa fa-github">&nbsp;</i></a><a href="http://weibo.com/u/5943175365" target="_blank" rel="noopener noreferrer"><i class="fa fa-weibo">&nbsp;</i></a><a href="https://blog.yocoh.cn/atom.xml" target="_blank" rel="noopener noreferrer"><i class="fa fa-rss">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2021&nbsp;<a target="_blank" href="https://yocoh.cn" rel="noopener noreferrer">饮夏</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p><p><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo" rel="noopener noreferrer">黔ICP备2020008614号-1</a></p><input id="switch1" type="checkbox" onclick="switchNightMode()" class="switch"><p><script src="https://yocoh.cn/api.php"></script></p>
</footer></div></div></div><div id="main-container" class="col-sm-9 col-xs-12 main-container invisible"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a>给博客加个夜间模式吧</a></p><p class="post-meta"><span class="date meta-item">发布于&nbsp;2020-10-26</span><span class="meta-item"><i class="fa fa-folder"></i><span>&nbsp;</span><a href="/categories/blog/" title="blog" class="a-tag">blog</a><span>&nbsp;</span></span><span class="meta-item"><i class="fa fa-tag"></i><span>&nbsp;</span><a href="/tags/blog插件/" title="blog插件" class="a-tag">blog插件</a><span>&nbsp;</span></span></p><p class="post-abstract"><p><del>白天都无人问津的破网站，真的还有人晚上来吗?</del></p>
<ul>
<li><strong>点击按钮切换模式</strong></li>
</ul>
<p>其实实现原理很简单:</p>
<p>点击<code>checkbox</code>的时候，为body新增（或移除）名为<code>night</code>的class，</p>
<p>然后在<code>css</code>的<code>night.class</code>里加入夜间模式的代码。</p>
<pre class="line-numbers language-lang-javascript"><code class="language-lang-javascript">//利用classList.add函数给body新增一个class
//js部分
...
function {
        checkbox=document.getElementById("checkbox")
        if(!checkbox.checked){
            document.body.classList.add('night');
            console.log('夜间模式开启啦');
            checkbox.checked=true;
        }else{
            document.body.classList.remove('night');
            console.log('夜间模式关闭啦');
            checkbox.checked.checked=false;
        }
    }
 ...
 //css部分
 ...
 body.night{
  background: rgba(3,3,3,0.7) no-repeat fixed center;
  color: $night_color;//更改颜色
}
...
//为了切换更平滑，在body中加入transition
...
body{
  background: rgba(233, 233, 233, 0.9) no-repeat fixed center;
  background-size: cover;
  transition: background-color 0.6s;
  color:$day_color
}
 ...
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>根据时间自动切换</strong></li>
</ul>
<p>加入一个简单的判定，让夜间模式自动切换。</p>
<pre class="line-numbers language-lang-javascript"><code class="language-lang-javascript">if(new Date().getHours() >=22 || new Date().getHours() <= 6){
                document.body.classList.add('night');
                console.log('夜间模式已开启，夜深啦，早点休息');
                box.checked=true;
            }else{
                document.body.classList.remove('night');
                console.log('夜间模式已关闭');
                box.checked=false;
            }
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>加入cookie</strong></li>
</ul>
<p>虽然是晚上，但是我就喜欢日间模式呀，为什么我明明关了夜间模式了，下一个页面又给我自动打开了！</p>
<p>这种情况不用怕，cookie轻松解决它。</p>
<pre class="line-numbers language-lang-javascript"><code class="language-lang-javascript">//新增一个cookie，如果night=1，则开启夜间模式，否则关闭。
//因为cookie缓存在本地，所以即使点开新的网页设定也不会改变。
...
//这部分是页面加载时的自动判定代码
...
if(document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") === '')//如果cookie不存在，则按照时间判定，并且将此时的状态写入cookie
        {
            if(new Date().getHours() >=22 || new Date().getHours() <= 6){
                document.body.classList.add('night');
                document.cookie = "night=1;path=/;SameSite=Strict";
                console.log('夜间模式已开启，夜深啦，早点休息');
                box.checked=true;
            }else{
                document.body.classList.remove('night');
                document.cookie = "night=0;path=/;SameSite=Strict";
                console.log('夜间模式已关闭');
                box.checked=false;
            }
        }
        else//如果cookie存在，则按照cookie中的设定切换夜间模式
        {
            let judge = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
            if (judge == '0') {
                document.body.classList.remove('night');
                console.log('cookie_Night_Mode:OFF');
                box.checked=false;
            } else if (judge == '1') {
                document.body.classList.add('night');
                console.log('cookie_Night_Mode:ON');
                box.checked=true;
                console.log(box.checked);
            }
        }
    ...
    //手动切换代码同样，切换之后加入cookie记录当前状态
    //此时可以用cookie作为夜间模式的判定，避免了使用checkbox作
    //判定时点击出错的问题。
    ...
    if(night == '0'){
            document.body.classList.add('night');
            document.cookie = "night=1;path=/;SameSite=Strict"
            console.log('夜间模式被手动开启啦');
            document.getElementById("switch1").checked=true;
        }else{
            document.body.classList.remove('night');
            document.cookie = "night=0;path=/;SameSite=Strict"
            console.log('夜间模式被手动关闭啦');
            document.getElementById("switch1").checked=false;
        }
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>关于背景的一个小问题。</strong></li>
</ul>
<p>这个是在设定背景图的时候发现的，设定背景图不随页面滚动的<code>background-attachment</code>属性在<code>ios</code>里无效。</p>
<p>原因是<code>ios</code>认为这个性能占用过多所以禁用了这个效果。</p>
<p>所以就出现了chrome上调试明明没问题但是iPhone上就是不对劲的情况。。。</p>
<p>解决方案也很简单，利用<code>:before</code>在body前新增一个伪类，然后在里面写<code>css</code>就🆗啦。</p>
<pre class="line-numbers language-lang-css"><code class="language-lang-css">body:before{
  content: '';
  position: fixed;
  z-index: -1;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
background:url("https://img.yocoh.cn/images/2020/11/01/15972576896501994d72a4b81afc7.jpg") center 0 no-repeat;
  background-size: cover;

}
//当然对其他元素也能得到相应的效果。
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>写在最后</strong></li>
</ul>
<p>最近其实在blog上修修补补的地方蛮多的，但是都感觉不能单独写一篇博文，而且懒嘛，就一直没动。</p>
<p>其实现在的夜间模式是有个小bug的，那就是自动切换部分如果当前时间与cookie设定冲突的话，会闪烁一下。查找到的解决方案是用<code>php</code>写页面，然后在body处加入<code>php</code>代码先进行判定。</p>
<p>但是暂时还没想到怎么运用到现在的这个主题中。</p>
<p>还有就是夜间模式不是很夜间，日间也不是很好看，颜色也只是随便调整了一下，并没有认真的微调，所以有些地方会显得很突兀。</p>
<p>欢迎点击右下角试试，然后评论告诉我意见或建议。</p>
<p>以上。</p>
</p></div><div class="share"><span>分享到</span>&nbsp;<span class="soc"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></span><span class="soc"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></span><span class="soc"><a href="http://twitter.com/home?status=https://blog.yocoh.cn/2020/10/26/给博客加个夜间模式吧/%20饮夏的blog%20给博客加个夜间模式吧" target="_blank" rel="noopener" class="fa fa-twitter"></a></span></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/2020/11/07/%E5%86%AC%E6%97%A5%E6%9D%A5%E4%BF%A1/" title="冬日来信。"><i class="fa fa-angle-double-left"></i>&nbsp;上一篇: 冬日来信。</a></span><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/2020/09/16/%E8%96%9B%E5%AE%9A%E8%B0%94%E4%B8%8E%E5%85%A8%E7%90%83%E5%8F%98%E6%9A%962/" title="全球变暖与薛定谔">下一篇: 全球变暖与薛定谔&nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div><section id="vcomments" class="comments"><style>.comments&quot;margin:30px;padding:10px;background:#fff&quot;@@media screen and (max-width:800px){.comments{margin:auto;padding:10px;background:#fff}}<key:post class="slug"></key:post><title:post class="title"></title:post></style><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><script>new Valine({
    el: "#vcomments",
    app_id: 'gwgMS1U22JvVVcg20JqEy6iu-MdYXbMMI',
    app_key: 'doyHiVx9YrwrOO0daNNT78GA',
    path: window.location.pathname,
    placeholder:'昵称处填写QQ可自动拉取昵称与头像~' ,
    avatar: 'monsterid',
    visiter: 'true',
    enableQQ: 'true'
})</script></section></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2021&nbsp;<a target="_blank" href="https://yocoh.cn" rel="noopener noreferrer">饮夏</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p><p><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo" rel="noopener noreferrer">黔ICP备2020008614号-1</a></p><input id="switch1" type="checkbox" onclick="switchNightMode()" class="switch"><p><script src="https://yocoh.cn/api.php"></script></p>
</footer></div></div><meting-js
            server="netease"
            type="playlist"
            id="363276397"
            fixed="true"
            autoplay="false"
            mutex="true"
            order="random">
    </meting-js><script>
    function switchNightMode(){
        let night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
        if(night == '0'){
            document.body.classList.add('night');
            document.cookie = "night=1;path=/;SameSite=Strict"
            console.log('夜间模式被手动开启啦');
            document.getElementById("switch1").checked=true;
        }else{
            document.body.classList.remove('night');
            document.cookie = "night=0;path=/;SameSite=Strict"
            console.log('夜间模式被手动关闭啦');
            document.getElementById("switch1").checked=false;
        }
    }

        let box=document.getElementById("switch1");
        let night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
        if(document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") === ''){
            if(new Date().getHours() >=22 || new Date().getHours() <= 6){
                document.body.classList.add('night');
                document.cookie = "night=1;path=/;SameSite=Strict";
                console.log('夜间模式已开启，夜深啦，早点休息');
                box.checked=true;
            }else{
                document.body.classList.remove('night');
                document.cookie = "night=0;path=/;SameSite=Strict";
                console.log('夜间模式已关闭');
                box.checked=false;
            }
        }else {
            let judge = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
            if (judge == '0') {
                document.body.classList.remove('night');
                console.log('cookie_Night_Mode:OFF');
                box.checked=false;
            } else if (judge == '1') {
                document.body.classList.add('night');
                console.log('cookie_Night_Mode:ON');
                box.checked=true;
                console.log(box.checked);
            }
        }
</script></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.js"></script><script src="https://git.yocoh.cn/img_full.js"></script></body></html>